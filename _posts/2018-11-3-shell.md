---
layout: post
title: Shell学习笔记
date: 2018-10-27
tag: 编程语言
---

## Shell变量
1. 命名规则
a. **变量名和等号之间不能有空格（不像其他编程语言那样一般都会使用空格!!!）**
b. 不能使用bash里的关键字
c. 命名规则和其他编程语言一样

2. 变量使用
```
test_value="haha"   赋值变量，基本数据类型一般只使用字符串和数字
echo ${test_value}  在命令行界面显示刚才命名的变量，获取变量值都是使用${变量名称}，变量名外面的花括号是可选的，加不加都行，加花括号是为了帮助解释器识别变量的边界
readonly test_value  使用 readonly 命令可以将变量定义为只读变量，只读变量的值不能被改变
unset test_value   使用 unset 命令可以删除变量，变量被删除后不能再次使用。unset 命令不能删除只读变量

```


## 注释
以 # 开头的行就是注释，会被解释器忽略，通过每一行加一个 # 号设置多行注释。
可以把这一段要注释的代码用一对花括号括起来，定义成一个函数，没有地方调用这个函数，这块代码就不会执行，达到了和注释一样的效果。
多行注释还可以使用以下格式：
```
:<<EOF
注释内容...
注释内容...
注释内容...
EOF

EOF也可以使用其他符号，比如
:<<'
注释内容...
注释内容...
注释内容...
'
或者
:<<!
注释内容...
注释内容...
注释内容...
!
```


## 字符串
1. 赋值规则
a. 字符串可以用单引号，也可以用双引号，也可以不用引号
b. 单引号字串中不能出现单独一个的单引号（对单引号使用转义符后也不行），但可成对出现，作为字符串拼接使用
c. 双引号里可以有变量，双引号里可以出现转义字符

2. 字符串操作
```
test_value="hello"
echo ${#test_value}   获取字符串长度，输出5 
echo ${test_value:1:2}   提取指定下标的子字符串，输出 el
echo `expr index "$test_value" ek`  查找字符 e 或 k 的位置(哪个字母先出现就计算哪个)，输出1
使用了两个反引号，也可不使用反引号，写成  echo $(expr index "$test_value" ek)
```


## 数组
1. 赋值规则
用括号来表示数组，数组元素用"空格"符号分割开。定义数组的一般形式为：
array_name=(value0 value1 value2 value3)  **也可以换行，但是注意是使用空格分隔，不要使用逗号！！！**

2. 数组使用
```
array_test=("haha" "hehe")
echo ${array_test[0]} 使用下标获取数组元素，输出 haha
echo ${array_test[@]} 使用 @或者* 符号可以获取数组中的所有元素
echo ${#array_test[@]} 获取数组长度的方法与获取字符串长度的方法相同，也可写成 echo ${#array_test[*]}
echo ${#array_test[0]} 取得数组单个元素的长度，输出4
```


## 传递参数及读取用户输入
命令行运行时传递没有命名的参数，依靠传入顺序进行取参
```
/bin/bash test.sh 1 2 3
获取传递进去的参数 $n  n代表一个数字，1 为执行脚本的第一个参数，2 为执行脚本的第二个参数，以此类推。
$# 传递到脚本的参数个数
$* 以一个单字符串显示所有向脚本传递的参数，以"$1 $2 … $n"的形式输出所有参数
$$ 脚本运行的当前进程ID号
$! 后台运行的最后一个进程的ID号
$* 与$*相同，但是使用时加引号，并在引号中返回每个参数，以"$1" "$2" … "$n" 的形式输出所有参数
$- 显示Shell使用的当前选项，与set命令功能相同
$? 显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误。
```

命令行运行时传入命名参数
```
使用脚本达到 /bin/bash test.sh value1=1 value2=2 的传参效果，并在脚本内像使用已经声明的变量一样
for arg in $@
do
  export $(echo $arg | cut -d= -f 1)=$(echo $arg | cut -d= -f 2)
done
```

运行脚本后使用read命令等待用户输入
```
read -p "提示信息" 变量名称
等待用户输入时，用户输入错误，按删除键回退时，会显示^M的错误，这时候可以加上一行stty erase '^H'
效果是脚本运行到该语句时会挺下来，输出相关提示信息，等待用户输入，可以使用 -t 30来等待30s，超时则继续往下执行。若是需要输入密码，则可以加 -s 参数，在界面上就看不到用户的输入了。
```
达到类似于Linux安装软件时输入Y/N的效果
read -n1 -p "install addon [Y/N]?" choice
case $choice in
Y | y)
      echo -e "\n start to install addon";;
N | n)
      echo -e "not install addon";;
*)
     echo "error choice";;
esac
exit 0
即按下一个字符进行回答，read命令立即接受输入并将其传给变量，无需按回车键。-n选项，后接数值，字符达到相应个数，则完成输入
```

## 判断流程控制
**shell里的if...else判断里面内容不能为空，不像其它编程语言！！！**
```
语法1：
if condition
then
    command1 
    command2
    ...
    commandN 
fi

语法2：
if condition
then
    command1 
    command2
    ...
    commandN
else
    command
fi

语法3
if condition1
then
    command1
elif condition2 
then 
    command2
else
    commandN
fi

也可以写成一行 if [ $a == $b ]; then echo "true"; fi
```
**特别需要注意的是，[$a==$b]的写法是错误的，判断条件表达式放在[]之间且必须要有空格，运算符也要有空格，如上面所示的 [ $a == $b ]**

## 常用数字运算
1. 基本算术计算

简单的数学运算一般使用 expr 命令，也可以把运算表达式写进$[]里进行直接运算。
```
echo $(expr 1 + 2)    表达式和运算符之间要有空格!!!
test_value=$[1+5] echo $test_value   输出6   数学运算一般放在$[]里面，这时候[]里面可以有空格，也可以没有
```
加减乘除取余等操作和其他编程语言类似，**但是做乘法时乘号(*)前边必须加反斜杠(\)才能实现乘法运算**

2. 关系运算
关系运算符只支持数字，不支持字符串，除非字符串的值是数字
```
运算符	             说明	
-eq	检测两个数是否相等，相等返回 true（可以使用 == 替换）	
-ne	检测两个数是否不相等，不相等返回 true	
-gt	检测左边的数是否大于右边的，如果是，则返回 true
-lt	检测左边的数是否小于右边的，如果是，则返回 true
-ge	检测左边的数是否大于等于右边的，如果是，则返回 true
-le	检测左边的数是否小于等于右边的，如果是，则返回 true

举例
if [ $a -lt $b ]
then
   echo "$a -lt $b: a 小于 b"
else
   echo "$a -lt $b: a 不小于 b"
fi
```

3. 布尔运算
```
运算符	                说明	
!	非运算，表达式为 true 则返回 false，否则返回 true
-o	或运算，有一个表达式为 true 则返回 true   （可以用||替换）
-a	与运算，两个表达式都为 true 才返回 true   （可以用&&替换）

举例
if [ $a -lt 100 -o $b -gt 100 ]
then
   echo "$a 小于 100 或 $b 大于 100 : 返回 true"
else
   echo "$a 小于 100 或 $b 大于 100 : 返回 false"
fi
```

4. 逻辑运算符
```
运算符	  说明	
&&	逻辑的 AND
||	逻辑的 OR

举例
if [[ $a -lt 100 || $b -gt 100 ]]
then
   echo "返回 true"
else
   echo "返回 false"
fi
```


## 字符串运算符
```
运算符	                             说明	
=	             检测两个字符串是否相等，相等返回 true
!=	             检测两个字符串是否相等，不相等返回 true
-z	             检测字符串长度是否为0，为0返回 true
-n	             检测字符串长度是否为0，不为0返回 true
$字符串名称	     检测字符串是否为空，不为空返回 true
```


## 文件测试运算符
```
操作符	             说明	
-b file	检测文件是否是块设备文件，如果是，则返回 true
-c file	检测文件是否是字符设备文件，如果是，则返回 true
-d file	检测文件是否是目录，如果是，则返回 true
-f file	检测文件是否是普通文件（既不是目录，也不是设备文件），如果是，则返回 true
-g file	检测文件是否设置了 SGID 位，如果是，则返回 true
-k file	检测文件是否设置了粘着位(Sticky Bit)，如果是，则返回 true
-p file	检测文件是否是有名管道，如果是，则返回 true
-u file	检测文件是否设置了 SUID 位，如果是，则返回 true
-r file	检测文件是否可读，如果是，则返回 true
-w file	检测文件是否可写，如果是，则返回 true
-x file	检测文件是否可执行，如果是，则返回 true
-s file	检测文件是否为空（文件大小是否大于0），不为空返回 true
-e file	检测文件（包括目录）是否存在，如果是，则返回 true
```





------------------------------------------------------------------
参考及部分引用文档：    
<a href="http://www.runoob.com" target="_blank">菜鸟教程</a>    
